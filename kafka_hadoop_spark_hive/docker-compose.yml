version: "1.2"
services:
  spark-hadoop-kafka:
    image: smartedu:1.2
    container_name: SmartEdu_backend
    restart: always
    ports:
      - "22:22" # SSH port
      - "9000:9000" # Hadoop Namenode UI port
      - "8088:8088" # Hadoop ResourceManager port
      - "9870:9870" # Hadoop Namenode port
      - "10000:10000" # HiveServer2 port
      - "9083:9083" # Hive Metastore port
      - "10500:10500" # HiveServer2 port
      - "9092:9092"  # Kafka port
      - "8888:8888"  # Jupyter Notebook port
    tty: true
    networks:
      - SmartEdu-network
    volumes:
      - ./src:/SmartEdu_src
      - hadoop_namenode:/hadoop/dfs/name
      - hadoop_datanode:/hadoop/dfs/data
      - hadoop_historyserver:/hadoop/yarn/timeline
    command: 
      - /bin/bash
      - -c
      - |
        source .bashrc
        source ~/.bashrc
        service ssh start
        start-dfs.sh
        start-yarn.sh
        kafka-server-start.sh $KAFKA_HOME/config/server.properties &
        jupyter notebook --ip=0.0.0.0 --port=8888 --no-browser --allow-root
networks:
  SmartEdu-network:
    external: true
volumes:
  hadoop_namenode:
  hadoop_datanode:
  hadoop_historyserver:


